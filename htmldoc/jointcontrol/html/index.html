<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>jointcontrol: Main Page</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">jointcontrol Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This package contains the source code for the <em>jointcontrol</em> ROS package. The goal of this package, is to learn the dynamics of a complex closed loop controller using a Reinforcement Learning (RL) model. This model is trained in simulation on an approximated reproduction of the real controller with the intent of deploying the fully trained model to the real controller. While physics-based training is done using <a href="https://pybullet.org/wordpress/">the Pybullet simulator</a>, the standardised interface between environment and RL agent defined by <a href="https://gym.openai.com/">OpenAI Gym</a> was used by implementing a custom Gym environment that connects the Gym and Bullet components to each other using the <a href="https://www.ros.org/">Robot Operating System (ROS)</a>.</p>
<p>This package allow for instantiation of an arbitrary amount of Gym environments, that all connect to a singe instance of the Bullet simulator. This allows for multiple agents to be trained in parallel. Simulation steps are performed synchronised between all instances in order to ensure accurate simulation.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Important Files</h1>
<p>These links can be used to quickly navigate to important files. The files are explained in detail in the following sections.</p>
<ul>
<li><a class="el" href="parseConfig_8py.html">parseConfig.py</a></li>
<li><a class="el" href="physicsServer_8py.html">physicsServer.py</a></li>
<li><a class="el" href="jointcontrol__env_8py.html">jointcontrol_env.py</a></li>
<li><a class="el" href="controllers_8py.html">controllers.py</a></li>
<li><a class="el" href="controllerTest_8py.html">controllerTest.py</a></li>
<li><a class="el" href="discreteActionWrapper_8py.html">discreteActionWrapper.py</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md1"></a>
Configuration</h2>
<p>The shared simulation environment in Bullet is created based on onfiguration files in the *./config* directory of the ROS package. Upon application start, the json config file is parsed by the <a class="el" href="parseConfig_8py.html">parseConfig.py</a> script, which loads all parameters into the ROS param server. The params are loaded as needed by the Gym environments as well as the simulation instance.</p>
<p>The configuration files are divided into two sections, one configuring controller parameters for each joint and one configuring the shared simulation itself. The parameters are explained below, for a full example of a complete config file, see testbenchConfig.json .</p>
<h3><a class="anchor" id="autotoc_md2"></a>
Simulation Params</h3>
<p>Simulation parameters are in the namespace /jointcontrol/SimParams/.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Param </th><th class="markdownTableHeadRight">Example Value </th><th class="markdownTableHeadNone">Explanation  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">JointLinearDamping </td><td class="markdownTableBodyRight">[0.04] </td><td class="markdownTableBodyNone">Linear damping for simulated joints (vector of len(JointsPerRobot))  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">JointAngularDamping </td><td class="markdownTableBodyRight">[70] </td><td class="markdownTableBodyNone">Angular damping for simulated joints (vector of len(JointsPerRobot))  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">JointTorques </td><td class="markdownTableBodyRight">[17] </td><td class="markdownTableBodyNone">Max torque a joint's actuator is able to provide (vector of len(JointsPerRobot))  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Ts </td><td class="markdownTableBodyRight">0.01 </td><td class="markdownTableBodyNone">Time discretisation in seconds (Set to match motors)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NumRobots </td><td class="markdownTableBodyRight">9 </td><td class="markdownTableBodyNone">Number of simulated robots  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">JointsPerRobot </td><td class="markdownTableBodyRight">1 </td><td class="markdownTableBodyNone">Number of joints per robot  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">IdsWithinRobot </td><td class="markdownTableBodyRight">[2] </td><td class="markdownTableBodyNone">IDs of movable joints within each robot (vector of len(JointsPerRobot))  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Realtime </td><td class="markdownTableBodyRight">"False" </td><td class="markdownTableBodyNone">Activates/Deactivates sleep statements to perform simulation in real time  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">StationSize </td><td class="markdownTableBodyRight">[1, 1] </td><td class="markdownTableBodyNone">Spacing between multiple instances of robots in bullet ([x,y], both in metres)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">StationsPerCol </td><td class="markdownTableBodyRight">3 </td><td class="markdownTableBodyNone">Determines the amount of robots per column in simulation (purely visual)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">URDFName </td><td class="markdownTableBodyRight">"TrainingTestbench.urdf" </td><td class="markdownTableBodyNone">Robot URDF name  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">URDFPath </td><td class="markdownTableBodyRight">"/catkin_ws/src/jointcontrol/urdf" </td><td class="markdownTableBodyNone">Global path to URDF file  </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md3"></a>
Joint Controller Params</h3>
<p>Controller params are set in the namespace /jointcontrol/J{}/. These params are used by the Gym environment with the same index to simulate physical properties of controller as well as plant and set controller bounds.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Param </th><th class="markdownTableHeadRight">Example Value </th><th class="markdownTableHeadNone">Explanation  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">NumParams </td><td class="markdownTableBodyRight">9 </td><td class="markdownTableBodyNone">Number of configurable parameters for this joint  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Defaults </td><td class="markdownTableBodyRight">[10, 0, 0, 0.05, 0, 0, 0, 0, 0] </td><td class="markdownTableBodyNone">Default parameters for this joint (vector of len(NumParams))  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Minimums </td><td class="markdownTableBodyRight">[0, 0, 0, 0, 0, 0, 0, 0, 0] </td><td class="markdownTableBodyNone">Minimum for each parameter that can be set (vector of len(NumParams))  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Maximums </td><td class="markdownTableBodyRight">[40, 1, 1, 10, 1, 1, 5, 1, 1] </td><td class="markdownTableBodyNone">Maximum for each parameter that can be set (vector of len(NumParams))  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">MaxChange </td><td class="markdownTableBodyRight">[10, 0.1, 0.1, 2.5, 0.1, 0.1, 1, 0.1, 0.1] </td><td class="markdownTableBodyNone">Maximum allowed change for each param per step (vector of len(NumParams))  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ParamDescription </td><td class="markdownTableBodyRight">"PID PID PID" </td><td class="markdownTableBodyNone">Description what each parameter represents (for convenience, not used)  </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md4"></a>
Physics Server</h2>
<p>The shared simulation is instantiated by the <a class="el" href="physicsServer_8py.html">physicsServer.py</a> script in *./scripts*. This script loads the configuration from the ROS param server, loads in robot models, manages synchronisation between Gym environments and tracks which RobotID, JointID pair in bullet corresponds to which Gym environment.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Gym Environment</h2>
<p>The Gym environment is implemented by <a class="el" href="jointcontrol__env_8py.html">jointcontrol_env.py</a> in *./gym-jointcontrol/gym_jointcontrol/envs/*. The controller whose dynamics should be learned by the agent, is modelled after the <a href="https://docs.hebi.us/core_concepts.html#control-strategies">Strategy 4 controller</a> found in the <a href="https://docs.hebi.us/core_concepts.html#core-modules">Hebi X-series actuators</a>. Implementations for each controller block are done in <a class="el" href="controllers_8py.html">controllers.py</a> in */scripts/*. The environment implements a normal <a href="https://github.com/openai/gym/blob/master/gym/core.py">GymEnv</a> and provides the <em>compute_reward</em> method, in a similar manner to <a href="https://github.com/openai/gym/blob/3394e245727c1ae6851b504a50ba77c73cd4c65b/gym/core.py#L160">GoalEnv</a>. Additionally, the last step can be visualised in matplotlib using the <em>visualiseTrajectory</em> method. For model testing, <a class="el" href="controllerTest_8py.html">controllerTest.py</a> in */scripts/* allows for automated step response and frequency response testing of controllers resulting from a model. For detailled info about implemented methods, refer to the generated class reference of <a class="el" href="jointcontrol__env_8py.html">jointcontrol_env.py</a> <a class="el" href="controllers_8py.html">controllers.py</a> and <a class="el" href="controllerTest_8py.html">controllerTest.py</a> .</p>
<p>Additionally, the Gym environment can be wrapped using the <a class="el" href="discreteActionWrapper_8py.html">discreteActionWrapper.py</a> class in *./scripts/*, in order to create a discrete action space, allowing for compatibility with more types of agents, such as <a href="https://stable-baselines.readthedocs.io/en/master/modules/dqn.html">Deep Q-Networks</a>. The action space is discretised by allowing the agent to increment or decrement each parameter by a fixed amount in the scaled action-space (range [-1, 1] for each parameter). Since the action space scales with the maximum allowed parameter change, this scaling also applies to the discretisation. This has been done, since it makes sense to allow a bigger change per step for proportional gains compared to derivative or integral gains. This discretisation factor can be set when instantiating the wrapper. The physical level of discretisation can be calculated per joint as <em>discretisation*maxChange</em> for each parameter. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/jointcontrol">jointcontrol</a><br />
Author(s): </br />
<small>autogenerated on Sat Feb 12 2022 17:56:50</small>
</div>
</body>
</html>
